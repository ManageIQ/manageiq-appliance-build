# Kickstart file automatically generated by anaconda.
# Run the text based installer to see dependency info in screenshots
logging --level=debug

#version=DEVEL
install
cdrom

<%= render_partial "main/repos" %>

lang en_US.UTF-8
keyboard us
network --onboot yes --device eth0 --bootproto dhcp
rootpw  --iscrypted $1$DZprqvCu$mhqFBjfLTH/PVvZIompVP/

authconfig --enableshadow --passalgo=sha512
selinux --enforcing
timezone --utc America/New_York

device mptbase
device mptscsih
device mptspi

bootloader --location=mbr --driveorder=vda --append="crashkernel=auto rhgb quiet net.ifnames=0 biosdevname=0"

<%= render_partial "main/disk_layout" %>
<%= render_partial "main/db_fs" %>

reboot

%packages
@base --nodefaults
@server-policy --nodefaults
@development tools

<%= render_partial "packages/includes" %>
<%= render_partial "packages/excludes" %>

%end

%post --log=/root/anaconda-post.log

exec < /dev/tty3 > /dev/tty3
chvt 3
set -x

# For some reason, DEBUG is set but empty in the kickstart.
# Unset it so ruby_parser doesn't print LOTS of output.
unset DEBUG

<%= render_partial "post/firewalld" %>

<%= render_partial "post/source_setup" %>

<%= render_partial "post/repos" %>

<%= render_partial "post/ruby_install" %>

<%= render_partial "post/bundler" %>

# appliance_root="/opt/manageiq/manageiq-appliance" -- in post/source_setup partial
$appliance_root/cfme-setup.sh

<%= render_partial "post/systemd" %>

<%= render_partial "post/db_init" %>

# Let's rebuild the ramfs with with base scsi drivers we need
kversion=$(rpm -q kernel --qf '%{version}-%{release}.%{arch}\n')
ramfsfile="/boot/initramfs-$kversion.img"
/sbin/dracut --force --add-drivers "mptbase mptscsih mptspi" $ramfsfile $kversion

chvt 1
%end
